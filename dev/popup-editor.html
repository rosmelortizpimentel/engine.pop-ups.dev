<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toggleup - Popup Editor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg-dark: #0a0a0a;
            --bg-panel: #141414;
            --bg-input: #1e1e1e;
            --border: #2a2a2a;
            --text: #e0e0e0;
            --text-muted: #888;
            --accent: #3b82f6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        .app {
            display: grid;
            grid-template-columns: 320px 1fr;
            height: 100vh;
        }

        /* Left Panel */
        .panel {
            background: var(--bg-panel);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-header h1 {
            font-size: 14px;
            font-weight: 600;
        }

        .panel-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        /* Type Selector */
        .type-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 12px;
        }

        .type-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-input);
            color: var(--text-muted);
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .type-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Sections */
        .section {
            margin-bottom: 12px;
            background: var(--bg-input);
            border-radius: 8px;
            padding: 10px;
        }

        .section-title {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--accent);
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        /* Form Fields */
        .field {
            margin-bottom: 8px;
        }

        .field:last-child {
            margin-bottom: 0;
        }

        .field label {
            display: block;
            font-size: 10px;
            color: var(--text-muted);
            margin-bottom: 3px;
        }

        .field input,
        .field select,
        .field textarea {
            width: 100%;
            padding: 7px 8px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
            font-size: 11px;
            font-family: inherit;
        }

        .field input:focus,
        .field select:focus,
        .field textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .field textarea {
            resize: none;
            height: 50px;
        }

        .row {
            display: flex;
            gap: 6px;
        }

        .row .field {
            flex: 1;
        }

        /* Color Field */
        .color-field {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .color-field input[type="color"] {
            width: 28px;
            height: 28px;
            padding: 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .color-field input[type="text"] {
            flex: 1;
        }

        /* Toggle */
        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 4px 0;
        }

        .toggle-row label {
            font-size: 11px;
            color: var(--text);
        }

        .toggle {
            width: 32px;
            height: 18px;
            background: var(--border);
            border-radius: 9px;
            position: relative;
            cursor: pointer;
        }

        .toggle.active {
            background: var(--accent);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.15s;
        }

        .toggle.active::after {
            transform: translateX(14px);
        }

        /* Buttons Section */
        .button-item {
            background: var(--bg-dark);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 6px;
        }

        .button-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .button-header span {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .btn-remove {
            width: 18px;
            height: 18px;
            background: #ef4444;
            border: none;
            border-radius: 3px;
            color: white;
            cursor: pointer;
            font-size: 11px;
            line-height: 1;
        }

        .btn-add {
            width: 100%;
            padding: 6px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 4px;
            color: var(--text-muted);
            font-size: 10px;
            cursor: pointer;
        }

        .btn-add:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Features */
        .feature-item {
            display: flex;
            gap: 4px;
            margin-bottom: 4px;
        }

        .feature-item input {
            flex: 1;
        }

        .feature-item button {
            width: 24px;
            background: var(--border);
            border: none;
            border-radius: 3px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 10px;
        }

        /* Right - Preview Area */
        .preview-area {
            background: linear-gradient(135deg, #667eea, #764ba2);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .preview-toolbar {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-toolbar h2 {
            font-size: 12px;
            color: white;
        }

        .preview-toolbar .btns {
            display: flex;
            gap: 8px;
        }

        .preview-toolbar button {
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-execute {
            background: #22c55e;
            color: white;
        }

        .btn-copy {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-json {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 10px;
        }

        .preview-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .preview-content .mock-page {
            background: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .mock-page h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .mock-page p {
            color: #666;
            font-size: 14px;
        }

        /* JSON Modal */
        .json-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
        }

        .json-modal.active {
            display: flex;
        }

        .json-modal-content {
            background: var(--bg-panel);
            border-radius: 12px;
            width: 500px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .json-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
        }

        .json-modal-header h3 {
            font-size: 14px;
        }

        .json-modal-header button {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 18px;
        }

        .json-modal textarea {
            flex: 1;
            background: var(--bg-dark);
            border: none;
            padding: 12px;
            color: #e0e0e0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            line-height: 1.5;
            resize: none;
            min-height: 400px;
        }

        /* Conditional */
        .modal-only,
        .banner-only {
            display: none;
        }

        [data-type="modal"] .modal-only {
            display: block;
        }

        [data-type="top_bar"] .banner-only {
            display: block;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #22c55e;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 12px;
            display: none;
            z-index: 999999;
        }
    </style>
</head>

<body>
    <div class="app" data-type="top_bar">
        <!-- Left Panel -->
        <div class="panel">
            <div class="panel-header">
                <span>üé®</span>
                <h1>Popup Editor</h1>
            </div>
            <div class="panel-scroll">
                <!-- Type -->
                <div class="type-selector">
                    <button class="type-btn active" data-value="top_bar" onclick="setType('top_bar')">Banner</button>
                    <button class="type-btn" data-value="modal" onclick="setType('modal')">Modal</button>
                </div>

                <!-- Layout -->
                <div class="section">
                    <div class="section-title">üìê Layout</div>
                    <div class="row banner-only">
                        <div class="field">
                            <label>Posici√≥n</label>
                            <select id="cfg-position" onchange="update()">
                                <option value="top">Arriba</option>
                                <option value="bottom">Abajo</option>
                            </select>
                        </div>
                    </div>
                    <div class="toggle-row banner-only">
                        <label>Fijo en pantalla</label>
                        <div class="toggle active" id="cfg-fixed" onclick="toggleField(this)"></div>
                    </div>
                    <div class="row modal-only">
                        <div class="field">
                            <label>Tama√±o</label>
                            <select id="cfg-size" onchange="update()">
                                <option value="small">Peque√±o</option>
                                <option value="medium" selected>Mediano</option>
                                <option value="large">Grande</option>
                            </select>
                        </div>
                    </div>
                    <div class="toggle-row">
                        <label>Bot√≥n cerrar (X)</label>
                        <div class="toggle active" id="cfg-showClose" onclick="toggleField(this)"></div>
                    </div>
                </div>

                <!-- Content -->
                <div class="section">
                    <div class="section-title">üìù Contenido</div>
                    <div class="field">
                        <label>T√≠tulo</label>
                        <input type="text" id="cfg-headline" oninput="update()" placeholder="¬°Oferta especial!">
                    </div>
                    <div class="field">
                        <label>Descripci√≥n</label>
                        <textarea id="cfg-body" oninput="update()" placeholder="Descripci√≥n del popup..."></textarea>
                    </div>
                </div>

                <!-- Image -->
                <div class="section">
                    <div class="section-title">üñºÔ∏è Imagen</div>
                    <div class="field">
                        <label>URL de imagen</label>
                        <input type="url" id="cfg-image" oninput="update()" placeholder="https://...">
                    </div>
                    <div class="row">
                        <div class="field modal-only">
                            <label>Posici√≥n</label>
                            <select id="cfg-img-pos" onchange="update()">
                                <option value="top">Arriba</option>
                                <option value="left">Izquierda</option>
                                <option value="right">Derecha</option>
                                <option value="background">Fondo</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Alto</label>
                            <input type="text" id="cfg-img-height" oninput="update()" placeholder="180px">
                        </div>
                    </div>
                </div>

                <!-- Features (Modal only) -->
                <div class="section modal-only">
                    <div class="section-title">‚úì Features (Lista)</div>
                    <div id="features-container"></div>
                    <button class="btn-add" onclick="addFeature()">+ Agregar feature</button>
                </div>

                <!-- Input (Modal only) -->
                <div class="section modal-only">
                    <div class="section-title">üìß Campo Email</div>
                    <div class="toggle-row">
                        <label>Habilitar campo</label>
                        <div class="toggle" id="cfg-input-enabled" onclick="toggleField(this)"></div>
                    </div>
                    <div class="field">
                        <label>Placeholder</label>
                        <input type="text" id="cfg-input-placeholder" oninput="update()" placeholder="tu@email.com">
                    </div>
                </div>

                <!-- Buttons -->
                <div class="section">
                    <div class="section-title">üîò Botones (m√°x 3)</div>
                    <div id="buttons-container"></div>
                    <button class="btn-add" onclick="addButton()">+ Agregar bot√≥n</button>
                </div>

                <!-- Footer (Modal only) -->
                <div class="section modal-only">
                    <div class="section-title">üìë Footer</div>
                    <div class="field">
                        <label>Texto</label>
                        <input type="text" id="cfg-footer" oninput="update()"
                            placeholder="Al continuar aceptas nuestros">
                    </div>
                    <div class="row">
                        <div class="field">
                            <label>Link 1 texto</label>
                            <input type="text" id="cfg-link1-text" oninput="update()" placeholder="T√©rminos">
                        </div>
                        <div class="field">
                            <label>URL</label>
                            <input type="text" id="cfg-link1-url" oninput="update()" placeholder="/terms">
                        </div>
                    </div>
                    <div class="row">
                        <div class="field">
                            <label>Link 2 texto</label>
                            <input type="text" id="cfg-link2-text" oninput="update()" placeholder="Privacidad">
                        </div>
                        <div class="field">
                            <label>URL</label>
                            <input type="text" id="cfg-link2-url" oninput="update()" placeholder="/privacy">
                        </div>
                    </div>
                </div>

                <!-- Style -->
                <div class="section">
                    <div class="section-title">üé® Estilos</div>
                    <div class="row">
                        <div class="field">
                            <label>Fondo</label>
                            <div class="color-field">
                                <input type="color" id="cfg-bg" value="#ffffff" onchange="update()">
                                <input type="text" id="cfg-bg-t" value="#ffffff" oninput="syncC(this,'cfg-bg')">
                            </div>
                        </div>
                        <div class="field">
                            <label>T√≠tulo</label>
                            <div class="color-field">
                                <input type="color" id="cfg-hc" value="#1a1a1a" onchange="update()">
                                <input type="text" id="cfg-hc-t" value="#1a1a1a" oninput="syncC(this,'cfg-hc')">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="field">
                            <label>Fuente</label>
                            <input type="text" id="cfg-font" oninput="update()" placeholder="Inter">
                        </div>
                        <div class="field">
                            <label>Border radius</label>
                            <input type="text" id="cfg-radius" oninput="update()" placeholder="16px">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview -->
        <div class="preview-area">
            <div class="preview-toolbar">
                <h2>Vista previa (simula p√°gina del cliente)</h2>
                <div class="btns">
                    <button class="btn-json" onclick="showJson()">{ } JSON</button>
                    <button class="btn-copy" onclick="copyJson()">üìã Copiar</button>
                    <button class="btn-execute" onclick="execute()">‚ñ∂ Ejecutar</button>
                </div>
            </div>
            <div class="preview-content">
                <div class="mock-page">
                    <h3>P√°gina del Cliente</h3>
                    <p>El popup aparecer√° sobre esta √°rea cuando hagas click en "Ejecutar"</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JSON Modal -->
    <div class="json-modal" id="json-modal">
        <div class="json-modal-content">
            <div class="json-modal-header">
                <h3>üìÑ JSON Configuration</h3>
                <button onclick="hideJson()">√ó</button>
            </div>
            <textarea id="json-editor" oninput="updateFromJson()"></textarea>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let type = 'top_bar';
        let buttons = [{ text: 'Aceptar', action: 'close', url: '', bg: '#3b82f6', tc: '#ffffff' }];
        let features = [];
        const editor = document.getElementById('json-editor');

        function setType(t) {
            type = t;
            document.querySelector('.app').dataset.type = t;
            document.querySelectorAll('.type-btn').forEach(b => b.classList.toggle('active', b.dataset.value === t));
            update();
        }

        function toggleField(el) { el.classList.toggle('active'); update(); }
        function syncC(t, id) { if (/^#[0-9A-Fa-f]{6}$/.test(t.value)) { document.getElementById(id).value = t.value; update(); } }

        // Features
        function renderFeatures() {
            document.getElementById('features-container').innerHTML = features.map((f, i) => `
                <div class="feature-item">
                    <input type="text" value="${f}" oninput="features[${i}]=this.value;update()" placeholder="Beneficio...">
                    <button onclick="features.splice(${i},1);renderFeatures();update()">√ó</button>
                </div>
            `).join('');
        }
        function addFeature() { features.push(''); renderFeatures(); }

        // Buttons
        function renderButtons() {
            document.getElementById('buttons-container').innerHTML = buttons.map((b, i) => `
                <div class="button-item">
                    <div class="button-header"><span>Bot√≥n ${i + 1}</span><button class="btn-remove" onclick="buttons.splice(${i},1);renderButtons();update()">√ó</button></div>
                    <div class="field"><input type="text" value="${b.text}" oninput="buttons[${i}].text=this.value;update()" placeholder="Texto"></div>
                    <div class="row">
                        <div class="field"><select onchange="buttons[${i}].action=this.value;update()"><option value="close" ${b.action === 'close' ? 'selected' : ''}>Cerrar</option><option value="link" ${b.action === 'link' ? 'selected' : ''}>Link</option></select></div>
                        <div class="field"><input type="text" value="${b.url || ''}" oninput="buttons[${i}].url=this.value;update()" placeholder="URL"></div>
                    </div>
                    <div class="row">
                        <div class="field color-field"><input type="color" value="${b.bg}" onchange="buttons[${i}].bg=this.value;update()"><span style="font-size:9px;color:#888">Fondo</span></div>
                        <div class="field color-field"><input type="color" value="${b.tc}" onchange="buttons[${i}].tc=this.value;update()"><span style="font-size:9px;color:#888">Texto</span></div>
                    </div>
                </div>
            `).join('');
        }
        function addButton() { if (buttons.length < 3) { buttons.push({ text: 'Bot√≥n', action: 'close', url: '', bg: '#e5e5e5', tc: '#333' }); renderButtons(); update(); } }

        // Build config
        function getConfig() {
            const c = {
                type,
                showCloseButton: document.getElementById('cfg-showClose').classList.contains('active'),
                content: {
                    headline: { text: document.getElementById('cfg-headline').value, style: { color: document.getElementById('cfg-hc').value } },
                    body: { text: document.getElementById('cfg-body').value, style: { color: '#666666' } }
                },
                buttons: buttons.filter(b => b.text).map(b => ({ text: b.text, action: b.action, url: b.url || undefined, style: { backgroundColor: b.bg, textColor: b.tc } })),
                style: { backgroundColor: document.getElementById('cfg-bg').value }
            };

            const font = document.getElementById('cfg-font').value;
            const radius = document.getElementById('cfg-radius').value;
            if (font) c.style.fontFamily = font;
            if (radius) c.style.borderRadius = radius;

            // Image
            const imgUrl = document.getElementById('cfg-image').value;
            if (imgUrl) {
                c.content.image = {
                    url: imgUrl,
                    position: type === 'modal' ? document.getElementById('cfg-img-pos').value : 'left',
                    height: document.getElementById('cfg-img-height').value || (type === 'modal' ? '180px' : '24px')
                };
            }

            // Type specific
            if (type === 'top_bar') {
                c.position = document.getElementById('cfg-position').value;
                c.fixed = document.getElementById('cfg-fixed').classList.contains('active');
            } else {
                c.size = document.getElementById('cfg-size').value;

                // Features
                const validFeatures = features.filter(f => f.trim());
                if (validFeatures.length) c.content.features = validFeatures.map(f => ({ icon: '‚úì', text: f }));

                // Input
                if (document.getElementById('cfg-input-enabled').classList.contains('active')) {
                    c.content.input = {
                        enabled: true,
                        type: 'email',
                        placeholder: document.getElementById('cfg-input-placeholder').value || 'tu@email.com'
                    };
                }

                // Footer with links
                const footerText = document.getElementById('cfg-footer').value;
                const link1Text = document.getElementById('cfg-link1-text').value;
                const link1Url = document.getElementById('cfg-link1-url').value;
                const link2Text = document.getElementById('cfg-link2-text').value;
                const link2Url = document.getElementById('cfg-link2-url').value;

                if (footerText || link1Text || link2Text) {
                    c.footer = { text: footerText || '' };
                    const links = [];
                    if (link1Text && link1Url) links.push({ text: link1Text, url: link1Url });
                    if (link2Text && link2Url) links.push({ text: link2Text, url: link2Url });
                    if (links.length) c.footer.links = links;
                }
            }

            return c;
        }

        function update() { editor.value = JSON.stringify(getConfig(), null, 2); }

        function updateFromJson() {
            try {
                const c = JSON.parse(editor.value);
                setType(c.type);
                document.getElementById('cfg-headline').value = c.content?.headline?.text || '';
                document.getElementById('cfg-body').value = c.content?.body?.text || '';
                document.getElementById('cfg-image').value = c.content?.image?.url || '';
                document.getElementById('cfg-img-height').value = c.content?.image?.height || '';
                document.getElementById('cfg-bg').value = c.style?.backgroundColor || '#ffffff';
                document.getElementById('cfg-bg-t').value = c.style?.backgroundColor || '#ffffff';
                document.getElementById('cfg-hc').value = c.content?.headline?.style?.color || '#1a1a1a';
                document.getElementById('cfg-hc-t').value = c.content?.headline?.style?.color || '#1a1a1a';
                document.getElementById('cfg-font').value = c.style?.fontFamily || '';
                document.getElementById('cfg-radius').value = c.style?.borderRadius || '';
                c.showCloseButton !== false ? document.getElementById('cfg-showClose').classList.add('active') : document.getElementById('cfg-showClose').classList.remove('active');

                if (c.type === 'top_bar') {
                    document.getElementById('cfg-position').value = c.position || 'top';
                    c.fixed !== false ? document.getElementById('cfg-fixed').classList.add('active') : document.getElementById('cfg-fixed').classList.remove('active');
                } else {
                    document.getElementById('cfg-size').value = c.size || 'medium';
                    document.getElementById('cfg-img-pos').value = c.content?.image?.position || 'top';
                    features = (c.content?.features || []).map(f => f.text || f);
                    renderFeatures();
                    c.content?.input?.enabled ? document.getElementById('cfg-input-enabled').classList.add('active') : document.getElementById('cfg-input-enabled').classList.remove('active');
                    document.getElementById('cfg-input-placeholder').value = c.content?.input?.placeholder || '';
                    document.getElementById('cfg-footer').value = c.footer?.text || '';
                    document.getElementById('cfg-link1-text').value = c.footer?.links?.[0]?.text || '';
                    document.getElementById('cfg-link1-url').value = c.footer?.links?.[0]?.url || '';
                    document.getElementById('cfg-link2-text').value = c.footer?.links?.[1]?.text || '';
                    document.getElementById('cfg-link2-url').value = c.footer?.links?.[1]?.url || '';
                }

                buttons = (c.buttons || []).map(b => ({ text: b.text, action: b.action, url: b.url || '', bg: b.style?.backgroundColor || '#3b82f6', tc: b.style?.textColor || '#fff' }));
                renderButtons();
            } catch (e) { }
        }

        function execute() {
            try {
                const c = JSON.parse(editor.value);
                if (window.ToggleupSDK?.showPopup) window.ToggleupSDK.showPopup(c);
                else toast('SDK no cargado', 1);
            } catch (e) { toast('JSON inv√°lido', 1); }
        }

        function showJson() { document.getElementById('json-modal').classList.add('active'); }
        function hideJson() { document.getElementById('json-modal').classList.remove('active'); }

        function copyJson() { navigator.clipboard.writeText(editor.value); toast('JSON copiado!'); }
        function toast(m, e) { const t = document.getElementById('toast'); t.textContent = m; t.style.background = e ? '#ef4444' : '#22c55e'; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 2000); }

        // Init
        renderButtons();
        renderFeatures();
        update();
    </script>
    <script src="/v1/sdk.js"></script>
</body>

</html>